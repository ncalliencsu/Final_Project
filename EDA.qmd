---
title: "EDA"
format: html
editor: visual
---

# Introduction

The Behavioral Risk Factor Surveillance System (BRFSS) is a health-related telephone survey that is collected annually by the CDC. Each year, the survey collects responses from over 400,000 Americans on health-related risk behaviors, chronic health conditions, and the use of preventative services. It has been conducted every year since 1984. For this ST-558 project, diabetes binary health indicators BRFSS2015.csv is a clean dataset of 253,680 survey responses to the CDC's BRFSS2015. The variables in the data set are listed and described below:

1.  Diabetes_binary\
    0 = no diabetes 1 = prediabetes 2 = diabetes

2.  HighBP\
    0 = no high BP 1 = high BP

3.  HighChol\
    0 = no high cholesterol 1 = high cholesterol

4.  CholCheck\
    0 = no cholesterol check in 5 years\
    1 = yes cholesterol check in 5 years

5.  BMI Body Mass Index

6.  Smoker\
    Have you smoked at least 100 cigarettes in your entire life?\
    \[Note: 5 packs = 100 cigarettes\]\
    0 = no 1 = yes

7.  Stroke\
    (Ever told) you had a stroke.\
    0 = no 1 = yes

8.  HeartDiseaseorAttack\
    coronary heart disease (CHD) or myocardial infarction (MI)\
    0 = no 1 = yes

9.  PhysActivity\
    physical activity in past 30 days - not including job\
    0 = no 1 = yes

10. Fruits\
    Consume Fruit 1 or more times per day\
    0 = no 1 = yes

11. Veggies\
    Consume Vegetables 1 or more times per day\
    0 = no 1 = yes

12. HvyAlcoholConsump\
    (adult men \>=14 drinks per week and adult women\>=7 drinks per week)\
    0 = no 1 = yes

13. AnyHealthcare\
    Have any kind of health care coverage, including health insurance, prepaid plans such as HMO, etc.\
    0 = no 1 = yes

14. NoDocbcCost\
    Was there a time in the past 12 months when you needed to see a doctor but could not because of cost?\
    0 = no 1 = yes

15. GenHlth\
    Would you say that in general your health is:\
    scale 1-5\
    1 = excellent\
    2 = very good\
    3 = good\
    4 = fair\
    5 = poor

16. MentHlth\
    days of poor mental health\
    scale 1-30 days

17. PhysHlth\
    physical illness or injury days in past 30 days\
    scale 1-30

18. DiffWalk\
    Do you have serious difficulty walking or climbing stairs?\
    0 = no 1 = yes

19. Sex\
    0 = female 1 = male

20. Age\
    13-level age category (\_AGEG5YR see codebook)  1 = 18-24\
    9 = 60-64\
    13 = 80 or older

21. Education\
    Education level (EDUCA see codebook)\
    scale 1-6\
    1 = Never attended school or only kindergarten 2 = elementary etc.

22. Income\
    Income scale (INCOME2 see codebook)\
    scale 1-8m\
    1 = less than \$10,000\
    5 = less than \$35,000\
    8 = \$75,000 or more

The target variable Diabetes_binary has 2 classes. 0 is for no diabetes, and 1 is for prediabetes or diabetes. This dataset has 21 predictor variables and is not balanced."Not balanced" refers to the distribution of the target classes (in this case, Diabetes_binary = 0 or 1). The number of samples in each class is unequal—one class (e.g., no diabetes) has more samples than the other (e.g., prediabetes or diabetes). The plan going in is to look consider all predictor variables.

The objectives of the EDA are:

-   basic validation of the data,
-   determine rate of missing values.
-   assign appropriate types to variables,
-   Investigate distributions ▪ Univariate measures/graphs ▪ Multivariate measures/graphs

The goal of the EDA is to inform the modeling process in the selection of model types.

```{r libraries}

library(gt)
library(janitor)
library(psych)
library(tidyverse)
library(vcd)

```

# Exploratory Data Analysis

```{r Import the Data}
data_00 <- read.csv("dbhealth_indicators_BRFSS2015.csv")
str(data_00)

```

The structure of the data reveals that all variables are assumed to be integers. Here is the conversion plan for the variables:

Columns 1-4, 6-14, 18 and 19 will be converted to 2-level factors.\
Columns 15, 21 and 22 will be converted to ordered factors.\
The remaining columns will be left as integers. Some columns will be renamed for readability.

```{r Assign Appropriate Data Types}
df <- data_00 |> mutate(across(c(1:4,6:14,18,19), as.factor))|>
  mutate(across(c(15,20,21,22), as_factor)) |> rename(Diabetes = Diabetes_binary, Heart_Cond = HeartDiseaseorAttack, Phys_Act = PhysActivity, Alcohol = HvyAlcoholConsump, Health_Ins = AnyHealthcare, Doctor_Cost = NoDocbcCost, Gen_Hlth = GenHlth, Mental_Hlth = MentHlth, Phys_Hlth = PhysHlth, Diff_Walk = DiffWalk, High_BP = HighBP, High_Chol = HighChol, Age_Group = Age, Chol_Check = CholCheck) 

psych::describe(df)
colSums(is.na(df))
str(df)
```

After review of the dataset data_01, in which many variables have been converted to factors, there are no missing values and the mins and maxes seem to be reasonable. The data was advertised as clean so this is what we would expect.

```{r Categorical Variable Summaries, eval=FALSE}
#2 Way Contingency Tables of Diabetes vs. Predictor Variables

two_way_tab <- function(var1 = "Diabetes", var2 = "HighBP"){
  
  ctab1 <- df %>%
          tabyl(!!sym(var1), !!sym(var2)) %>%
          adorn_totals("row") %>%
          adorn_percentages("col") %>%
          adorn_pct_formatting(digits = 2) %>%
          adorn_ns()

  ctab2 <- gt(ctab1, rowname_col = var1) %>%
          tab_spanner(
            columns = names(ctab1)[-1], # all columns except the first
            label = var2
          ) %>%
          tab_stubhead(
            label = var1
          ) %>%
          tab_header(
            title = paste("2-Way Contingency Table for", var1, "and", var2)
          ) 

        print(ctab2)
 }

 for(i in colnames(df[-1])){
    two_way_tab("Diabetes", i )
 }
```

## Summary Statistics
```{r Summary Statistics}

# Numeric Summaries
summary(df)

#Correlation Statistics

#Tetrachoric Correlation Matrix for Binary Variables
df_binary <- df |> mutate(across(c(1:4,6:14,18,19), as.numeric)) |> select(c(1:4,6:14,18,19)) 
                          
tetra_corr <- tetrachoric(df_binary)$rho
cat("\n")
print("Tetrachoric Correlation Matrix")
print(tetra_corr)

#Point-BiSerial Correlation Matrix for Ordinal and Continuous Variables
# Source - https://stackoverflow.com/a/77630670

#create a function 
point_biserial_cor <- function(binary_var, continuous_var) {
  cor.test(as.numeric(binary_var), as.numeric(continuous_var), method = "pearson")$estimate
}

# Identify binary and continuous variables
binary_var <- names(df[1])
continuous_vars <- names(df[c(5, 15:17, 20:22)])

# Do the correlation matrix
pbs_cor_matrix <- matrix(NA, nrow = length(continuous_vars), ncol = 1, dimnames = list(continuous_vars, binary_var))

# Calculate correlations
for (var in continuous_vars) {
  pbs_cor_matrix[var, binary_var] <- point_biserial_cor(df[[binary_var]], df[[var]])
}

# View the correlation matrix
cat("\n")
print("Point Biserial Correlation Matrix")
print(pbs_cor_matrix)

```

I developed code that generated 2 -Way Contingency Tables for all the variables against Diabetes, but they would not render to HTML.  So, I left the code in the document but set eval = FALSE. If you run the code chunk for Categorical Variables Summaries you can have a look at the Tables and look for differences in percentages in the rows between Diabetes = 0 and Diabetes = 1.

I did perform correlation studies. Tetrachoric correlation is a measure of the correlation between two binary variables. This type of correlation is often used in surveys and personality tests in which the questions being asked only have two possible response values. The value for a tetrachoric correlation can range from -1 to 1 where:

-1 indicates a strong negative correlation between the two variables. 0 indicates no correlation between the two variables. (Statology.org)

From inspection of the Tetrachoric Correlation Matrix, there appears to be some moderate correlation between Diabetes and the following binary predictor variables:

-   High_BP (50%)
-   Diff_Walk (41%)
-   High_Chol (38%)
-   Heart_Cond (38%)
-   Stroke (29%)
-   Phys_Act (-23%)
-   Alcohol (-23%)


Point-biserial correlation is used to measure the relationship between a binary variable, x, and a continuous variable, y. Similar to the Pearson correlation coefficient, the point-biserial correlation coefficient takes on a value between -1 and 1 where:

-1 indicates a perfectly negative correlation between two variables 0 indicates no correlation between two variables 1 indicates a perfectly positive correlation between two variables (Statology.org)

From inspection of the Point-biserial correlation matrix, there appears to be some moderate correlation between Diabetes and the following ordinal and continuous predictor variables:

-   BMI(22%)
-   Gen_Hlth(29%)

For all of my assessments here on correlation, I used 20% as the cutoff, which is still not a strong correlation. The strongest correlations with Diabetes from this data are High Blood Pressure, High Cholesterol, Heart Condition and Difficulty Walking. Note that all these have correlations with each other at approximately 40% levels. I am not sure if this is enough to collapse them into one variable.

## Graphical Summaries
```{r Graphical Summaries}
    
#Histograms of Ordinal and Continuous Variables
hist(df$BMI, xlab="BMI", main="Histogram of BMI")
hist(as.numeric(df$Gen_Hlth), xlab="Gen_Hlth", main="Histogram of Gen_Hlth")
hist(as.numeric(df$Mental_Hlth), xlab="Mental_Hlth", main="Histogram of Mental_Hlth")
hist(as.numeric(df$Phys_Hlth), xlab="Phys_Hlth", main="Histogram of Phys_Hlth")
hist(as.numeric(df$Age_Group), xlab="Age Group", main="Histogram of Age Group")
hist(as.numeric(df$Education), xlab="Education", main="Histogram of Education")
hist(as.numeric(df$Income), xlab="Income", main="Histogram of Income")

#Grouped Bar Plots
ggplot(data = df, aes(x= Diabetes , fill = High_BP)) +
  geom_bar(position = "dodge") +
  labs(x = "Diabetes") +
  scale_fill_discrete("High_BP") +
  labs(title = "Count of Diabetes by High_BP", x = "Diabetes", y = "Count by HighBP")

ggplot(data = df, aes(x= Diabetes , fill = Alcohol )) +
  geom_bar(position = "dodge") +
  labs(x = "Diabetes") +
  scale_fill_discrete("Alcohol") +
  labs(title = "Count of Diabetes by Alcohol", x = "Diabetes", y = "Count by Alcohol")

ggplot(data = df, aes(x= Diabetes , fill = Sex )) +
  geom_bar(position = "dodge") +
  labs(x = "Diabetes") +
  scale_fill_discrete("Sex") +
  labs(title = "Count of Diabetes by Sex", x = "Diabetes", y = "Count by Sex")

#Box Plots
ggplot(df, aes(x = Age_Group , y = Diabetes )) +
  geom_boxplot() + labs(title = "Boxplot of Diabetes by Age Group", x = "Age Group", y = "Diabetes") +
  scale_x_discrete(breaks=seq(min(as.numeric(df$Age_Group)),max(as.numeric(df$Age_Group)),by=1))

ggplot(df, aes(x = BMI , y = Diabetes )) +
  geom_boxplot() + labs(title = "Boxplot of Diabetes by BMI", x = "BMI", y = "Diabetes")

ggplot(df, aes(x= Age_Group, y= Diabetes)) +
 geom_boxplot(notch=FALSE, outlier.shape=NA, fill="red", alpha=0.1)+
 theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  scale_x_discrete(breaks=seq(min(as.numeric(df$Age_Group)),max(as.numeric(df$Age_Group)),by=1))  + 
  
 facet_wrap(. ~ Education, scales = "free_y") +
  theme(axis.text.x = element_text(angle = 90, vjust=.5, hjust=1)) + 
  labs(title = "Boxplots of Diabetes by Age Group and Education", x = "Age Group", y = "Diabetes")


ggplot(df, aes(x= Age_Group, y= Diabetes)) +
 geom_boxplot(notch=FALSE, outlier.shape=NA, fill="red", alpha=0.1)+
 theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  scale_x_discrete(breaks=seq(min(as.numeric(df$Age_Group)),max(as.numeric(df$Age_Group)),by=1))  + 
  
 facet_wrap(. ~ Income, scales = "free_y") +
  theme(axis.text.x = element_text(angle = 90, vjust=.5, hjust=1)) + 
  labs(title = "Boxplots of Diabetes by Age Group and Income", x = "Age Group", y = "Diabetes")

#Mosaic Plots
mosaic(data = df, ~ Education + Diabetes, highlighting = "Diabetes",
       highlighting_fill = c("lightblue", "pink"),
       rot_labels=c(0,90,0,0), just_labels=c("left","right"),
       main = "Mosaic Plot of Diabetes and Education")

mosaic(data = df, ~ Income + Diabetes, highlighting = "Diabetes",
       highlighting_fill = c("lightblue", "pink"),
       rot_labels=c(0,90,0,0), just_labels=c("left","right"),
       main = "Mosaic Plot of Diabetes and Income")

mosaic(data = df, ~ High_BP + Diabetes, highlighting = "Diabetes",
       highlighting_fill = c("lightblue", "pink"),
       rot_labels=c(0,90,0,0), just_labels=c("left","right"),
       main = "Mosaic Plot of Diabetes and High_BP")

mosaic(data = df, ~ Age_Group + Diabetes, highlighting = "Diabetes",
       highlighting_fill = c("lightblue", "pink"),
       rot_labels=c(0,90,0,0), just_labels=c("left","right"),
       main = "Mosaic Plot of Diabetes and Age Group")
```

The histograms show something interesting. From inspection of the Income and Education Histograms, it appears as though there is a bias in the sample toward higher education and higher income individuals. I cannot imagine that was a desired outcome, but it looks like a defect in the sampling plan.

The Bar Plots show what we expect with HighBP having an effect on Diabetes. We can also see that Sex does not seem to have much of an effect, and it could be argued that Alcohol has a positive effect on the Diabetes out come.

The Box Plots of Diabetes vs. Age and Income seem to show a different picture than the Mosaic Plots. Here, on the faceted Boxplot of Diabetes vs. Age and Income it is not really discernible if there is a difference. The Box Plot of Diabetes vs. BMI suggests that BMI does not have a strong impact on Diabetes. The Boxplot of Diabetes vs Age suggests that Age does have an effect on Diabetes and this agrees with the Mosaic Plot.

A mosaic plot is a graphical representation of the relationships in a contingency table, showing the proportions of combinations of categorical variables as tiles. It’s useful for visualizing associations between two or more categorical variables. The mosaic plot for Income and Diabetes shows a trend in higher incidence of Diabetes for lower income individuals. With the sample bias toward higher income individuals, the relationship of Diabetes to Income might be much greater than we see in this survey.

## Link to Modeling Page

[Click Here for Modeling Page](https://www.example.com)


